{% load pageurl image_tags %}

{% if gallery_items %}
    <section class="gallery module x-plus" data-pagination=".pagination">
        <div class='item-container row'>
            <ul class='row'>
                {% for galleryitem in gallery_items %}
                    {% with galleryitem.carousel_items.all as carousel_items %} 
                        {% with carousel_items|first as carousel_item %}
                            {% if carousel_item.image %}        
                                {% include "rca/includes/gallery_snippet.html" with gallery_image=carousel_item.image %}
                            {% elif carousel_item.poster_image %}
                                {% include "rca/includes/gallery_snippet.html" with gallery_image=carousel_item.poster_image %}
                            {% endif %}
                        {% endwith %}
                    {% endwith %}
                {% endfor %}

                {% if gallery_items.paginator.count > 5 %}
                    <li class="load-more newrow gallery-load-more"><a href="#">+</a></li>
                {% endif %}
            </ul>
        </div>
    </section>

    <ul class="pagination infinite">
        <!--
        {% if gallery_items.has_previous %}
            <li class="previous"><a href="?page={{ gallery_items.previous_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">Previous</a></li>
        {% endif %}
        -->

        {% if gallery_items.has_next %}
            <li class="next"><a href="?page={{ gallery_items.next_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">Next</a></li>
        {% endif %}
    </ul>

{% endif %}

<script type="text/javascript">
    {% if related_programmes %}
        var related_programmes = {{related_programmes|safe}};
    {% else %}
        var related_programmes = [];
    {% endif %}
</script>
