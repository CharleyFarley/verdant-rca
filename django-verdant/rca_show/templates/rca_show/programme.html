{% extends "rca_show/base.html" %}
{% load show_tags rich_text pageurl %}

{% block body_class %}{{ block.super }} type-programme school-{{ school }}{% endblock %}

{% block content %}
    {% get_programme_students self.show_index programme as students %}
    {% if "fashionmenswear" in self.get_programmes %}
        {# NON-random students for fashion show #}
        {% get_programme_students self.show_index programme as rand_students %}
    {% elif "animation" in self.get_programmes %}
        {# NON-random students for Animation show #}
        {% get_programme_students self.show_index programme as rand_students %}
        {% get_programme_works self.show_index programme as works %}
    {% else %}
        {% get_programme_students self.show_index programme True as rand_students %}
    {% endif %}
    {% get_school_programmes self.show_index school as programmes %}
    {% get_schools self.show_index as schools %}

    <section class="shownav{% if self.show_index.menu_items|length >= 4 %} four-items{% endif %}">
        {% if not self.is_programme_page or "animation" in self.get_programmes %}
            <ul class="nav-overview">
                {% for item in self.show_index.menu_items %}
                    <li {% if item.0 == self.url %}class="active"{% endif %}>
                        <a href="{{ item.0 }}">{{ item.1 }}</a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
        <ul>
            {# Big nasty 'if' to change what dropdowns are available for the Animation programme only #}
            {% if "animation" in self.get_programmes %}
                <li class="jumplist">
                    <h2 class="toggle">Films by student</h2>
                    <div class="selected toggle"></div>
                    <ul class="options">
                        {# assumption that animation is 1 of 1 programmes defined #}
                        {% get_programme_students self.show_index programme as students %}
                        {% for student in students %}
                            <li>
                                <a href="{% show_subpage_url self.show_index 'student' school=student.school programme=student.programme slug=student.slug %}">
                                    <span class="student">{{ student.title }}</span>
                                    <span class="work">{{ student.show_work_title }}</span>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
                <li class="jumplist">
                    <h2 class="toggle">Films by title</h2>
                    <div class="selected toggle"></div>
                    <ul class="options">
                        {% for student in works %}
                            <li>
                                <a href="{% show_subpage_url self.show_index 'student' school=student.school programme=student.programme slug=student.slug %}">
                                    <span class="work">{{ student.show_work_title }}</span>
                                    <span class="student">{{ student.title }}</span>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% else %}

                {% if self.is_programme_page %}
                    <li class="jumplist">
                        <h2 class="toggle">Students</h2>
                        <div class="selected toggle"></div>
                        <ul class="options">
                            {% if self.get_programmes|length > 1 %}
                                {% for programme in self.get_programmes %}
                                    <li><a href="{% show_subpage_url self.show_index 'programme' programme=programme %}"><b>{% get_programme_display programme %}</b></a></li>
                                    {% get_programme_students self.show_index programme as students %}
                                    {% for student in students %}
                                        <li><a href="{% show_subpage_url self.show_index 'student' school=student.school programme=student.programme slug=student.slug %}">{{ student.title }}</a></li>
                                    {% endfor %}
                                {% endfor %}
                            {% else %}
                                {% get_programme_students self.show_index programme as students %}
                                {% for student in students %}
                                    <li><a href="{% show_subpage_url self.show_index 'student' school=student.school programme=student.programme slug=student.slug %}">{{ student.title }}</a></li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </li>
                    {% for item in self.show_index.menu_items %}
                        <li>
                            <a href="{{ item.0 }}">{{ item.1 }}</a>
                        </li>
                    {% endfor %}
                {% else %}
                    <li class="jumplist active">
                        <h2 class="toggle">Select a School</h2>
                        <div class="selected toggle">{% get_school_display school %}</div>
                        <ul class="options">
                            {% for school in schools %}
                                <li><a href="{% show_subpage_url self.show_index 'school' school=school %}">{% get_school_display school %}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    <li class="jumplist active">
                        <h2 class="toggle">Select a Programme</h2>
                        <div class="selected toggle">{% get_programme_display programme %}</div>
                        <ul class="options">
                            {% for programme in programmes %}
                                <li><a href="{% show_subpage_url self.show_index 'programme' school=school programme=programme %}">{% get_programme_display programme %}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    <li class="jumplist">
                        <h2 class="toggle">Select a Student</h2>
                        <div class="selected toggle"></div>
                        <ul class="options">
                            {% for student in students %}
                                <li><a href="{% show_subpage_url self.show_index 'student' school=student.school programme=student.programme slug=student.slug %}">{{ student.title }}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                {% endif %}
            {% endif %}
        </ul>
    </section>

    {% include "rca/includes/modules/carousel.html" with overlayvisible=0 %}

    {% if not self.is_programme_page %}
        <h1>{% get_programme_display programme %}</h1>
    {% endif %}

    {% include "rca_show/includes/modules/gallery.html" with students=rand_students %}    
{% endblock %}

{% block sidebar %}
    {% include "rca/includes/sidebar.html" with showToday="true" %}
{% endblock %}