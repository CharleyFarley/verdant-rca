{% extends "student_profiles/edit_base.html" %}
{% load static compress %}

{% block form_content %}

<div class="page-content">
  {% if messages %}
  <ul class="messages">
      {% for message in messages %}
      <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
      {% endfor %}
  </ul>
  {% endif %}
  <h1>MA show details</h1>
  <section class="row">
    <section class="body-text">
      <form method="POST" class="student-profile" accept-charset="utf-8" enctype="multipart/form-data">{% csrf_token %}

        {% include 'student_profiles/form_snippet.html' with form=show_form %}

        {{ carouselitem_formset.management_form }}
        Carousel images/videos
        <div id="{{ carouselitem_formset.prefix }}">
        {% for carouselitem_form in carouselitem_formset %}
          <div class="inline-form">
            {{ carouselitem_form.id }}
            {% include 'student_profiles/form_snippet.html' with form=carouselitem_form %}
          <input type="hidden" class="order-value" name="{{ form.prefix }}-ORDER" value="{{ forloop.counter0 }}">
          <i class="icon action ion-android-arrow-up move-up"></i>
          <i class="icon action ion-android-arrow-down move-down"></i>
          </div>
        {% endfor %}
        </div>

        {% include "student_profiles/formset_single_field.html" with formset=show_collaborators_formset %}
        {% include "student_profiles/formset_single_field.html" with formset=show_sponsors_formset %}


        <div class="profile-actions">
          <input type="submit" class="profile-save" value="Save">
          <input type="submit" class="submit-page" value="Save and submit" name="submit_for_publication">
          <a class="button" href="{% url 'student-profiles:preview' page_id %}" target="_blank">Preview</a>
        </div>
      </form>
    </section>
  </section>
</div>

{% endblock form_content %}


{% block extra_css %}

{{ block.super }}
{% endblock extra_css %}


{% block form_js %}
<script type="text/javascript">
$(function() {

  function updateSelects() {
    $('#carousel select').change(function() {
      var value = $(this).val();
      var _match = this.id.match(/id_carousel-(\d+)-item_type/);
      var id_number = _match ? _match[1] : '';
      
      if (value == 'image')        {# image, as defined in forms.py #}
      {
        $('#carousel-' + id_number + '-image_id').show();
        $('#id_carousel-' + id_number + '-overlay_text').parent().show();

        $('#id_carousel-' + id_number + '-embedly_url').parent().hide();
        $('#carousel-' + id_number + '-poster_image_id').hide();
        $('#id_carousel-' + id_number + '-embedly_url').val('');
        $('#carousel-' + id_number + '-poster_image_id input').val('');
      } else if (value == 'video') {# video #}
      {
        $('#carousel-' + id_number + '-image_id').hide();
        $('#id_carousel-' + id_number + '-overlay_text').parent().hide();
        $('#carousel-' + id_number + '-image_id input').val('');
        $('#id_carousel-' + id_number + '-overlay_text').val('');
        
        $('#id_carousel-' + id_number + '-embedly_url').parent().show();
        $('#carousel-' + id_number + '-poster_image_id').show();
      }
    });
  };
  
  makeFormset('{{ show_collaborators_formset.prefix }}');
  makeFormset('{{ show_sponsors_formset.prefix }}');
  makeFormset('{{ carouselitem_formset.prefix }}',
    addedFunc=function(row) {
      updateSelects();
      row.find('select').each(function(){ $(this).trigger('change')});
      row.find('.image-uploader-block').each(function(i) { activateImageUpload(this.id); });
    }
  );
  
  makeRichTextEditable('id_show_work_description');
  activateImageUpload('postcard_image');
  $('.image-uploader-block').each(function(i) {
    activateImageUpload(this.id);
  });
  
  updateSelects();
  $('#carousel select').each(function(i) {
    $(this).trigger('change');
  });
  
})
</script>
{% endblock form_js %}



