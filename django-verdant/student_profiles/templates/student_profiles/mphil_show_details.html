{% extends "student_profiles/edit_base.html" %}
{% load static %}

{% block form_content %}

<div class="page-content">
  {% if messages %}
  <ul class="messages">
      {% for message in messages %}
      <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
      {% endfor %}
  </ul>
  {% endif %}
    {% if mphil_show_form.errors or carouselitem_formset.errors or collaborator.errors or sponsor.errors %}
    <div class="warning">The data you submitted could not be saved. Please check the form below for error messages.</div>
    {% endif %}
  <h1>Show Project Details</h1>
  <section class="row">
    <section class="body-text">
      <form method="POST" class="student-profile" accept-charset="utf-8" enctype="multipart/form-data">{% csrf_token %}
        
        {% include 'student_profiles/form_snippet.html' with form=mphil_show_form %}

        {% include "student_profiles/carousel_form.html" with formset=carouselitem_formset %}

        {% include "student_profiles/formset_single_field.html" with formset=collaborator %}
        {% include "student_profiles/formset_single_field.html" with formset=sponsor %}

        {{ supervisor.management_form }}
        <h4>Supervisors</h4>
        <div id="{{ supervisor.prefix }}" class="field-set">
        {% for form in supervisor %}
          <div class="inline-form">
            {{ form.id }}
            {% include 'student_profiles/form_snippet.html' with form=form %}
            <i class="icon action ion-android-arrow-up move-up"></i>
            <i class="icon action ion-android-arrow-down move-down"></i>
          </div>
        {% endfor %}
        </div>

        <div class="profile-actions">
          <input type="submit" class="profile-save" value="Save Draft">
          <input type="submit" class="" value="Preview" name="preview" formtarget="_blank">
          <input type="submit" class="submit-page" value="Save and submit" name="submit_for_publication">
        </div>
      </form>
    </section>
    <section class="notes">
      <h3>Notes</h3>
      <p>Upload your Profile for Show RCA. You can include multiple images and videos which will appear on a carousel on your Profile page in the Show catalogue.</p>
      <p>The form will save automatically every so often. Before you log out, click 'Save as Draft' if you want to return and edit another time; or click 'Submit for Moderation' if youâ€™re ready for your profile information to appear online.</p>
    </section>
  </section>
</div>

{% endblock form_content %}



{% block form_js %}
<script type="text/javascript">

makeFormset('{{ collaborator.prefix }}');
makeFormset('{{ sponsor.prefix }}');
makeFormset('{{ supervisor.prefix }}');
makeFormset('{{ carouselitem_formset.prefix }}',
  addedFunc=function(row) {
    updateCarouselSelects('{{ carouselitem_formset.prefix }}');
    row.find('select').each(function(){ $(this).trigger('change')});
    row.find('.image-uploader-block').each(function(i) { activateImageUpload(this.id); });
    row.find('.image-uploader-block img').replaceWith('<div class="preview_canvas"></div>');
  }
);

makeRichTextEditable('id_mphil_statement');
$('.image-uploader-block').each(function(i) {
  activateImageUpload(this.id);
});

updateCarouselSelects('{{ carouselitem_formset.prefix }}');
$('#carousel select').each(function(i) {
  $(this).trigger('change');
});
  
updateSupervisorSelects('{{ supervisor.prefix }}');
$('#{{ supervisor.prefix }} select').each(function(i) {$(this).trigger('change');});

$('.supervisor-select').select2();

</script>
{% endblock form_js %}
