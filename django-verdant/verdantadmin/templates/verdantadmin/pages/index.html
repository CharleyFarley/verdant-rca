{% extends "verdantadmin/base.html" %}

{% block bodyclass %}page-explorer {% if ordering == 'ord' %}reordering{% endif %}{% endblock %}

{% block content %}
    <header class="merged no-border">
        <h1>Explorer</h1>

        <ul class="breadcrumb">
            <li><a href="{% url 'verdantadmin_explore_root' %}" class="icon icon-home text-replace">Home</a></li>
            {% for page in parent_page.get_ancestors %}
                <li><a href="{% url 'verdantadmin_explore' page.id %}">{{ page.title }}</a></li>
            {% endfor %}
        </ul>
    </header>
   
    <form id="page-reorder-form" action="{% url 'verdantadmin_pages_reorder' parent_page.id %}" method="POST">
        {% csrf_token %}
        <input type='hidden' name='order' id='order'>

        {% include "verdantadmin/pages/list.html" with sortable=1 allow_navigation=1 full_width=1 parent_page=parent_page orderable=1 %} 

        {% if ordering == 'ord' %}
            <footer>
                <ul>
                    <li class="actions">
                        <input type="submit" value="Save order" class="button" />
                    </li>
                </ul>
            </footer>
        {% endif %}
    </form>

{% endblock %}

{% block extra_js %}
    <script type="text/javascript">
        {% if ordering == 'ord' %}
            $(function() {
                $('.listing tbody').sortable({
                    cursor: "move", 
                    containment: "parent", 
                    handle: ".handle", 
                    items: "> tr",
                    axis: "y",
                    placeholder: "dropzone",
                    start: function(){
                        $(this).parent().addClass('sorting');
                    },
                    stop: function(){
                        $(this).parent().removeClass('sorting');
                    }
                });
                $('.listing tbody').disableSelection();

                $('#page-reorder-form').submit(function() {
                    $('#order').val($('.listing tbody').sortable('toArray'));
                    return true;
                });
            })
        {% endif %}
    </script>
{% endblock %}
